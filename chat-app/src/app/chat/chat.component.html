<div *ngIf="!selectedChatId" class="chat-container">
  <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç</h2>

  <div class="form">
    <label>
      –ù–∞–∑–≤–∞–Ω–∏–µ —á–∞—Ç–∞:
      <input [(ngModel)]="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–∏–∞–ª–æ–≥ —Å –º–∞–≥–æ–º" />
    </label>

    <label>
      –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
      <textarea [(ngModel)]="initial" placeholder="–ü—Ä–∏–≤–µ—Ç! –ö—Ç–æ —Ç—ã?.."></textarea>
    </label>

    <button (click)="createChat()">–°–æ–∑–¥–∞—Ç—å —á–∞—Ç</button>
    <div class="error" *ngIf="error">{{ error }}</div>
  </div>

  <h3>–ú–æ–∏ —á–∞—Ç—ã</h3>
  <ul class="chat-list">
    <li *ngFor="let chat of chats"
        [class.selected]="chat.id === selectedChatId">
      <div class="chat-row">
        <span (click)="selectChat(chat.id)" class="chat-name">
          üó®Ô∏è {{ chat.name }}
        </span>
        <span class="chat-actions">
          <button mat-icon-button color="warn"
                  (click)="confirmDelete(chat.id, $event)"
                  matTooltip="–£–¥–∞–ª–∏—Ç—å —á–∞—Ç">
            <mat-icon>delete</mat-icon>
          </button>
        </span>
      </div>
    </li>
  </ul>
</div>

<div *ngIf="selectedChatId" class="chat-box">
  <h3>–°–æ–æ–±—â–µ–Ω–∏—è</h3>

  <div class="messages" #scrollContainer>
    <div *ngFor="let msg of messages; let i = index"
         [ngClass]="{'message-user': msg.sender_type === 'user', 'message-assistant': msg.sender_type === 'assistant'}">
      <ng-container *ngIf="editingMessageId === msg.id; else viewMode">
        <input [(ngModel)]="editingMessageText" class="edit-message-input" />
        <span class="msg-actions">
          <button mat-icon-button color="primary" (click)="applyEditMessage()" matTooltip="–ü—Ä–∏–º–µ–Ω–∏—Ç—å">
            <mat-icon>check</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="cancelEditMessage()" matTooltip="–û—Ç–º–µ–Ω–∞">
            <mat-icon>close</mat-icon>
          </button>
        </span>
      </ng-container>
      <ng-template #viewMode>
        {{ msg.message }}
        <span class="msg-actions">
          <button mat-icon-button color="accent" (click)="startEditMessage(msg)" matTooltip="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
            <mat-icon>edit</mat-icon>
          </button>
          <ng-container *ngIf="i === messages.length - 1">
            <button mat-icon-button color="warn" (click)="deleteMessage(msg.id)" matTooltip="–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
              <mat-icon>delete</mat-icon>
            </button>
            <button mat-icon-button color="primary" (click)="regenerateMessage(msg.id)" matTooltip="–†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
              <mat-icon>autorenew</mat-icon>
            </button>
          </ng-container>
        </span>
      </ng-template>
    </div>
  </div>

  <div class="send-box">
    <input [(ngModel)]="newMessage" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." (keydown.enter)="sendMessage()" />
    <button (click)="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>
